<div class="container mx-auto p-4">
	<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
		<!-- Left Sidebar -->
		<div class="col-span-1 md:col-span-1 rounded-lg p-4">
			<div class="text-center">
				<img
					[src]="profilePictureUrl$ | async"
					alt="User Profile Picture"
					class="w-32 h-32 sm:w-48 sm:h-48 md:w-64 md:h-64 rounded-full mx-auto mb-4 object-cover" />
				<h1 class="text-xl font-semibold mb-3">
					{{ (consultedUser$ | async)?.username }}
				</h1>
				<p class="text-gray-400 mb-2">
					{{ (consultedUser$ | async)?.description }}
				</p>
				<ng-container *ngIf="isFollowing$ | async; else notFollowing">
					<button
						class="mt-4 px-4 py-2 bg-secondary text-light-bg rounded-lg"
						(click)="unfollowUser()">
						<span>Suivi &#10003;</span>
					</button>
				</ng-container>
				<ng-template #notFollowing>
					<button
						class="mt-4 px-4 py-2 rounded-lg"
						[ngClass]="
							followRequestSent ? 'bg-secondary text-light-bg' : 'bg-primary'
						"
						[disabled]="followRequestSent"
						(click)="followUser()">
						<span class="flex items-center gap-x-2">
							{{ followRequestSent ? 'Demande envoyée' : 'Suivre' }}
							<ng-container *ngIf="(consultedUser$ | async)?.isPrivate">
								<app-icon icon="lock"></app-icon>
							</ng-container>
						</span>
					</button>
				</ng-template>
				<div
					class="grid grid-cols-1 sm:grid-cols-3 justify-items-center mt-8 w-full">
					<div class="text-center order-2 sm:order-1">
						<span class="text-xl font-semibold">{{
							(consultedUser$ | async)?.posts?.length || 0
						}}</span>
						<p class="text-gray-400">posts</p>
					</div>
					<div class="text-center order-1 sm:order-2">
						<span class="text-xl font-semibold">{{
							(consultedUser$ | async)?.followers?.length || 0
						}}</span>
						<p class="text-gray-400">abonnés</p>
					</div>
					<div class="text-center order-3 sm:order-3">
						<span class="text-xl font-semibold">{{
							(consultedUser$ | async)?.following?.length || 0
						}}</span>
						<p class="text-gray-400">abonnements</p>
					</div>
				</div>
			</div>
			<!-- Public Groups -->
			<div class="mt-10 flex flex-col items-center">
				<ng-container
					*ngIf="
						(consultedUser$ | async)?.isPrivate === false &&
						(isFollowing$ | async) === false
					">
					<h2 class="text-2xl font-semibold mb-4">Groups</h2>
					<app-profile-groups
						[userGroups]="userGroups$ | async"></app-profile-groups>
				</ng-container>
			</div>
		</div>
		<!-- Main Content -->
		<div class="col-span-1 md:col-span-2 rounded-lg p-4">
			<!-- Post List -->
			<ng-container
				*ngIf="
					(consultedUser$ | async)?.isPrivate &&
						(isFollowing$ | async) === false;
					else showPosts
				">
				<div
					class="text-gray-400 flex flex-col items-center justify-center h-full text-center">
					<p class="mt-4">
						Ce profil est privé. Vous devez suivre
						<b>&commat;{{ (consultedUser$ | async)?.username }}</b> pour voir
						ses posts.
					</p>
					<img
						src="assets/images/cadenas.svg"
						alt="Cadenas"
						class="w-64 h-64" />
				</div>
			</ng-container>
			<ng-template #showPosts>
				<!-- Pinned Post -->
				<ng-container *ngIf="pinnedPost$ | async as pinnedPost">
					<app-pinned-post
						[post]="pinnedPost"
						[isOwnProfile]="false"></app-pinned-post>
				</ng-container>
				<app-post-list
					[posts]="userPosts$ | async"
					[isOwnProfile]="false"></app-post-list>
			</ng-template>
		</div>
	</div>
</div>
